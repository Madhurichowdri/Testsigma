#!/bin/bash

# ===== CONFIGURATION =====
TESTSIGMA_API_KEY="eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiIzOWM2Njc1ZC0yODI4LTRjYzgtOGQ4My1kNzVkZGU2MDNjNjIiLCJkb21haW4iOiJsZW5kZXJwcmljZS5jb20iLCJ0ZW5hbnRJZCI6NjQ0MTIsImlzSWRsZVRpbWVvdXRDb25maWd1cmVkIjpmYWxzZX0.Ikin4knr3-eydn0RvFfahqo1T-8eJRXQriweyn0HIBMjw9QZCBfpt18DhcP9XIpW3tjoKmrd6tFg-hiXK6_PcQeyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiIzOWM2Njc1ZC0yODI4LTRjYzgtOGQ4My1kNzVkZGU2MDNjNjIiLCJkb21haW4iOiJsZW5kZXJwcmljZS5jb20iLCJ0ZW5hbnRJZCI6NjQ0MTIsImlzSWRsZVRpbWVvdXRDb25maWd1cmVkIjpmYWxzZX0.Ikin4knr3-eydn0RvFfahqo1T-8eJRXQriweyn0HIBMjw9QZCBfpt18DhcP9XIpW3tjoKmrd6tFg-hiXK6_PcQ"
TESTSIGMA_TEST_PLAN_ID="curl -X POST -H "Content-type: application/json" -H "Accept:application/json" -H "Authorization: Bearer <API_KEY>" https://app.testsigma.com/api/v1/execution_results -d "{\"executionId\": \"5689\", \"environmentId\": \"<ENVIRONMENT_ID>\"}"

# Base URL (don't change unless advised)
TESTSIGMA_TEST_PLAN_REST_URL="https://app.testsigma.com/api/v1/execution_results"

echo "Triggering Testsigma test plan: $TESTSIGMA_TEST_PLAN_ID"

# ===== TRIGGER THE TEST PLAN =====
TRIGGER_RESPONSE=$(curl -s -X POST "$TESTSIGMA_TEST_PLAN_REST_URL" \
  -H "Authorization: Bearer $TESTSIGMA_API_KEY" \
  -H "Content-Type: application/json" \
  -d "{\"executionId\": \"$TESTSIGMA_TEST_PLAN_ID\"}")

RUN_ID=$(echo "$TRIGGER_RESPONSE" | grep -o '"id":[0-9]*' | cut -d: -f2)

if [ -z "$RUN_ID" ]; then
  echo "❌ Failed to trigger Testsigma execution."
  echo "Response: $TRIGGER_RESPONSE"
  exit 1
fi

echo "✅ Test run triggered successfully. Run ID: $RUN_ID"

exit 0
